# 图解TCP/IP笔记

### OSI七层模型

- **应用层**：针对特定应用的协议
- **表示层**：设备固有数据格式和网络格式的转换
- **会话层**：通信管理。负责建立和断开通信连接的时机
- **传输层**：管理两个节点之间的数据传输，负责可靠的数据传输
- **网络层**：地址管理和路由选择，就是寻址和路由选择。
- **数据链路层**：互联设备之间的传输和识别数据帧（将数据帧转换为比特流）
- **物理层**：比特流与电子信号的切换。

---

### 连接方式

- 面向有连接和面向无连接
- 电路交换和分组交换（分组交换有并行思想，把数据分割成一个个数据帧分组传输可以让所有计算机同时发送数据，而不是一个发完再到另一个）
- 根据接收端数量的分类：单播，广播，多播，任播。

---

### 连接互联网的设备

- 中继器：在物理层把物理信号放大
- 网桥/二层交换机：可以把0、1序列信号重构数据帧，处于数据链路层的交换设备。并有丢弃错误数据帧的功能
- 路由器/三层交换机：处于网络层，可以把数据帧重构，并拆解到网络层状态，并通过IP地址判断网络路径，转发至目标地址。

---

### TCP/IP五层结构

- 应用层：实现了OSI模型中的应用层，会话层和表示层
- 传输层：让机器上对应的应用程序进行通信，标识端口号，使用TCP协议保证传输可靠性或使用UDP协议实现多播或广播以及视频通信等多媒体领域
- 网络层：相当于OSI的网络层，使用IP协议进行路由选择。使数据顺利传输到另一台主机。
- 数据链路层：也叫网络接口层。跟OSI的数据链路层类似。
- 物理层：负责数据传输的硬件。

传输过程中的数据包：

> 应用层：数据
>
> 传输层：TCP包首部 + 数据
>
> 网络层：IP包首部 + TCP包首部 + 数据
>
> 数据链路层：以太网包首部 + IP包首部 + TCP包首部 + 数据

---

### 数据链路层 - 以太网

**以太网是应用最广泛的一种数据链路**

以太网帧的格式

> 6字节的目标MAC地址 + 6字节的源MAC地址 + 2字节的上层协议类型 + 数据 + 4字节的FCS用于检测帧是否有所损坏

---

### 网络层

网络层的主要作用是连接不同的数据链路，也就是说数据可以跨越不同种类的数据链路进行传输。

> 数据链路负责提供直连两个设备之间的通信功能，网络层则负责在没有直连的两个网络之间进行通信传输，可以这样理解，数据链路负责两个直连设备的通信，而网络层负责指挥下一步应该去哪里。

IP实现多个数据链路之间的通信，不同的数据链路各自的最大传输单位也有差异，IP协议通过分片处理对这些大小不一的数据链路进行抽象处理。

IP协议面向无连接。在这种方式下可能会有较多的冗余的通信。但是IP协议为了实现简单化和高速化，还是采用了面向无连接，然后通过上一层 - 传输层的TCP进行可靠性的保证。

> 有人说：为什么要分成TCP和IP，一个保证可靠性一个用来传输？其实如果合并成一个协议，那这个协议会变得十分复杂，无法轻易去实现。如果进行了网络分层，明确TCP和IP协议的目的，有利于这些协议的可扩展性和性能上的优化，分层也简化了协议的实现。

---

### 传输层

传输层的TCP首部包含有目标端口号和源端口号

