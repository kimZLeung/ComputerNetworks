# 互联网传输协议

---

## MAC地址
> 网卡的地址，就是数据包的发送地址和接收地址，这叫做`MAC`地址。这个是每一个网卡的独一无二的地址，可以配合`IP`地址定位网络接受端。包含在数据包的以太网协议的`Head`

---
## 网络层
> 因为只有`MAC`地址无法定位一台计算机，因为真的太多了。所以我们出现了网络层。互联网由无数个子网络组成，所以我们必须找到一个方法，让数据在互联网中传输的时候能分辨这个`MAC`地址在哪个子网络下

## IP地址
> `IP`地址就是网络地址，`IP`地址是接入网络之后被分配的地址。`IP`地址分为两部分，前部分代表网络，后部分代表主机。我们通过子网掩码去区分哪一部分是网络，哪一部分的主机

## ARP协议
> `ARP`协议用于从`IP`地址中获取`MAC`地址。分两种情况：1、如果两台计算机不在同一个子网络下，那么是没有办法获得对方的`MAC`地址的，会交给网关去处理。2、如果两台计算机在同一个子网络下，就可以使用`ARP`协议发送一个数据包，包含了一个所要查询主机的`IP`地址，然后广播，每一台主机用自己的`IP`地址去比较，如果相同就返回自己的`MAC`地址。

---
## 传输层
> 通过了`IP`地址和`MAC`地址。我们可以找到我们所查询的地址，并建立通信。
同一台主机上也有不同的端口，用于处理不同的网络程序。端口的作用是：**提供给不同的网络进程接受数据包的编号。**
端口是从0到65535之间的整数，从0到1023的端口号被系统占用，用户只能选用大于1023的端口。

**而传输层的作用，就是建立“端口到端口的通信”**

## UDP协议
> 对，`UDP`和`IP`协议一样也有自己的数据包。也是由`Head`和`Data`组成的，用这个来带上端口号

## TCP协议
> `TCP`协议是比较安全的`UDP`协议，三次握手确定了对方能收到己方发送的数据。`TCP`协议每发送一个数据包就需要对方确定收到。`TCP`协议提供可靠的字节流服务，把数据切成一个个数据包。`TCP`首部带有发送接收的主机端口号。

---
## DNS
> `DNS`就是用来解析域名的，把域名解析为`IP`地址

---
## 传输过程

```
/* 传输的数据包的结构
 *
 *   Head              Head            Head               Data
 *  以太网头部         IP协议           TCP协议             应用层
 *  双方MAC地址       双方IP地址      端口，字节流            数据
 */
 
 先TCP协议包一层TCP头部，再用IP协议包一层，IP协议的Data部分就是TCP协议的数据包。最后再用以太网包一层
```

## 一个过程
> 一个网络请求从一台主机发出的时候。首先要明确两个地址：`IP`地址和`MAC`地址，首先`IP`地址可以通过`DNS`服务解析出来。然后就是`MAC`地址。有两个情况：1、发送主机和接受主机在同一个子网下，那么就用`ARP`协议找到对方的`MAC`地址。2、不在同一个子网下，那就必须知道网关的`MAC`地址。

所以一台主机能上网的前提需要四个参数：

- 本机的IP地址
- 子网掩码
- 网关的IP地址
- DNS的IP地址


### 不过通常用户都会默认选择动态IP地址

## DHCP协议
> 动态`IP`使用的协议。设置一些相关参数，发出独特的数据包：把以太网协议的`Head`的本地`MAC`地址设成本机的`MAC`地址，接收方的`MAC`地址设成一个广播地址，把`IP`的`Head`设置发出`IP`地址为0.0.0.0，接收的`IP`地址为255.255.255.255.把`UDP`的`Head`设成发出方`68`端口，接收方`67`端口


---
参考：

 - [互联网协议入门 (1)][1]
 - [互联网协议入门 (2)][2]
 - [HTTP协议—— 简单认识TCP/IP协议][3]


  [1]: http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html
  [2]: http://www.ruanyifeng.com/blog/2012/06/internet_protocol_suite_part_ii.html
  [3]: http://www.cnblogs.com/roverliang/p/5176456.html